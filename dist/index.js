!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(global,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(e);var s=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=e,this.selectionEnd=r}return function(t,e,r){e&&n(t.prototype,e),r&&n(t,r)}(t,[{key:"equals",value:function(t){return this.position===t.position&&this.selectionEnd===t.selectionEnd}},{key:"compose",value:function(t){return t}},{key:"transform",value:function(e){function r(t){for(var r=t,n=e.ops,s=0,i=e.ops.length;s<i&&(n[s].isRetain()?t-=n[s].chars:n[s].isInsert()?r+=n[s].text.length:(r-=Math.min(t,n[s].chars),t-=n[s].chars),!(t<0));s++);return r}var n=r(this.position);return this.position===this.selectionEnd?new t(n,n):new t(n,r(this.selectionEnd))}}],[{key:"fromJSON",value:function(e){return new t(e.position,e.selectionEnd)}}]),t}(),i=function(t,e){if(!t)throw new Error(e||"assertion error")};function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.chars=null,this.text=null,this.attributes=null,"insert"===e?(this.text=arguments.length<=1?void 0:arguments[1],i("string"==typeof this.text),this.attributes=(arguments.length<=2?void 0:arguments[2])||{},i("object"===o(this.attributes))):"delete"===e?(this.chars=arguments.length<=1?void 0:arguments[1],i("number"==typeof this.chars)):"retain"===e&&(this.chars=arguments.length<=1?void 0:arguments[1],i("number"==typeof this.chars),this.attributes=(arguments.length<=2?void 0:arguments[2])||{},i("object"===o(this.attributes)))}return function(t,e,r){e&&a(t.prototype,e),r&&a(t,r)}(t,[{key:"isInsert",value:function(){return"insert"===this.type}},{key:"isDelete",value:function(){return"delete"===this.type}},{key:"isRetain",value:function(){return"retain"===this.type}},{key:"equals",value:function(t){return this.type===t.type&&this.text===t.text&&this.chars===t.chars&&this.attributesEqual(t.attributes)}},{key:"attributesEqual",value:function(t){var e=this;return t&&this.attributes?Object.keys(this.attributes).every(function(r){return e.attributes[r]===t[r]})&&Object.keys(t).every(function(r){return e.attributes[r]===t[r]}):t===this.attributes}},{key:"hasEmptyAttributes",value:function(){var t=!0;for(var e in this.attributes){t=!1;break}return t}}]),t}();function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ops=[],this.baseLength=0,this.targetLength=0}return function(t,e,r){e&&c(t.prototype,e),r&&c(t,r)}(t,[{key:"equals",value:function(t){if(this.baseLength!==t.baseLength)return!1;if(this.targetLength!==t.targetLength)return!1;if(this.ops.length!==t.ops.length)return!1;for(var e=0;e<this.ops.length;e++)if(!this.ops[e].equals(t.ops[e]))return!1;return!0}},{key:"retain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("number"!=typeof t||t<0)throw new Error("retain expects a positive integer.");if(0===t)return this;this.baseLength+=t,this.targetLength+=t;var r=this.ops.length>0?this.ops[this.ops.length-1]:null;return r&&r.isRetain()&&r.attributesEqual(e)?r.chars+=t:this.ops.push(new h("retain",t,e)),this}},{key:"insert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof t)throw new Error("insert expects a string");if(""===t)return this;this.targetLength+=t.length;var r=this.ops.length>0?this.ops[this.ops.length-1]:null,n=this.ops.length>1?this.ops[this.ops.length-2]:null;return r&&r.isInsert()&&r.attributesEqual(e)?r.text+=t:r&&r.isDelete()?n&&n.isInsert()&&n.attributesEqual(e)?n.text+=t:(this.ops[this.ops.length-1]=new h("insert",t,e),this.ops.push(r)):this.ops.push(new h("insert",t,e)),this}},{key:"delete",value:function(t){if("string"==typeof t&&(t=t.length),"number"!=typeof t||t<0)throw new Error("delete expects a positive integer or a string");if(0===t)return this;this.baseLength+=t;var e=this.ops.length>0?this.ops[this.ops.length-1]:null;return e&&e.isDelete()?e.chars+=t:this.ops.push(new h("delete",t)),this}},{key:"isNoop",value:function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()}},{key:"clone",value:function(){for(var e=new t,r=0;r<this.ops.length;r++)this.ops[r].isRetain()?e.retain(this.ops[r].chars,this.ops[r].attributes):this.ops[r].isInsert()?e.insert(this.ops[r].text,this.ops[r].attributes):e.delete(this.ops[r].chars);return e}},{key:"toString",value:function(){return this.ops.map(function(t){return t.isRetain()?"retain ".concat(t.chars):t.isInsert()?"insert '".concat(t.text,"'"):"delete ".concat(t.chars)}).join(", ")}},{key:"toJSON",value:function(){for(var t=[],e=0;e<this.ops.length;e++)this.ops[e].hasEmptyAttributes()||t.push(this.ops[e].attributes),"retain"===this.ops[e].type?t.push(this.ops[e].chars):"insert"===this.ops[e].type?t.push(this.ops[e].text):"delete"===this.ops[e].type&&t.push(-this.ops[e].chars);return t}},{key:"apply",value:function(t,e,r){if(e=e||[],r=r||[],t.length!==this.baseLength)throw new Error("The operation's base length must be equal to the string's length.");for(var n,s,o=[],a=0,h=0,u=this.ops,c=0,l=u.length;c<l;c++){var f=u[c];if(f.isRetain()){if(h+f.chars>t.length)throw new Error("Operation can't retain more characters than are left in the string.");for(o[a++]=t.slice(h,h+f.chars),n=0;n<f.chars;n++){var p=e[h+n]||{},g={};for(s in p)g[s]=p[s],i(!1!==g[s]);for(s in f.attributes)!1===f.attributes[s]?delete g[s]:g[s]=f.attributes[s],i(!1!==g[s]);r.push(g)}h+=f.chars}else if(f.isInsert())for(o[a++]=f.text,n=0;n<f.text.length;n++){var b={};for(s in f.attributes)b[s]=f.attributes[s],i(!1!==b[s]);r.push(b)}else h+=f.chars}if(h!==t.length)throw new Error("The operation didn't operate on the whole string.");var y=o.join("");return i(y.length===r.length),y}},{key:"invert",value:function(e){for(var r=0,n=new t,s=this.ops,i=0,o=s.length;i<o;i++){var a=s[i];a.isRetain()?(n.retain(a.chars),r+=a.chars):a.isInsert()?n.delete(a.text.length):(n.insert(e.slice(r,r+a.chars)),r+=a.chars)}return n}},{key:"compose",value:function(e){if(this.targetLength!==e.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");function r(t,e,r){var n,s={};for(n in t)s[n]=t[n];for(n in e)r&&!1===e[n]?delete s[n]:s[n]=e[n];return s}for(var n,s=new t,i=this.clone().ops,o=e.clone().ops,a=0,h=0,u=i[a++],c=o[h++];void 0!==u||void 0!==c;)if(u&&u.isDelete())s.delete(u.chars),u=i[a++];else if(c&&c.isInsert())s.insert(c.text,c.attributes),c=o[h++];else{if(void 0===u)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===c)throw new Error("Cannot compose operations: first operation is too long.");if(u.isRetain()&&c.isRetain())n=r(u.attributes,c.attributes),u.chars>c.chars?(s.retain(c.chars,n),u.chars-=c.chars,c=o[h++]):u.chars===c.chars?(s.retain(u.chars,n),u=i[a++],c=o[h++]):(s.retain(u.chars,n),c.chars-=u.chars,u=i[a++]);else if(u.isInsert()&&c.isDelete())u.text.length>c.chars?(u.text=u.text.slice(c.chars),c=o[h++]):u.text.length===c.chars?(u=i[a++],c=o[h++]):(c.chars-=u.text.length,u=i[a++]);else if(u.isInsert()&&c.isRetain())n=r(u.attributes,c.attributes,!0),u.text.length>c.chars?(s.insert(u.text.slice(0,c.chars),n),u.text=u.text.slice(c.chars),c=o[h++]):u.text.length===c.chars?(s.insert(u.text,n),u=i[a++],c=o[h++]):(s.insert(u.text,n),c.chars-=u.text.length,u=i[a++]);else{if(!u.isRetain()||!c.isDelete())throw new Error("This shouldn't happen: op1: ".concat(JSON.stringify(u),", op2: ").concat(JSON.stringify(c)));u.chars>c.chars?(s.delete(c.chars),u.chars-=c.chars,c=o[h++]):u.chars===c.chars?(s.delete(c.chars),u=i[a++],c=o[h++]):(s.delete(u.chars),c.chars-=u.chars,u=i[a++])}}return s}},{key:"shouldBeComposedWith",value:function(e){if(this.isNoop()||e.isNoop())return!0;var r=t.getStartIndex(this),n=t.getStartIndex(e),s=t.getSimpleOp(this),i=t.getSimpleOp(e);return!(!s||!i)&&(s.isInsert()&&i.isInsert()?r+s.text.length===n:!(!s.isDelete()||!i.isDelete())&&(n+i.chars===r||r===n))}},{key:"shouldBeComposedWithInverted",value:function(e){if(this.isNoop()||e.isNoop())return!0;var r=t.getStartIndex(this),n=t.getStartIndex(e),s=t.getSimpleOp(this),i=t.getSimpleOp(e);return!(!s||!i)&&(s.isInsert()&&i.isInsert()?r+s.text.length===n||r===n:!(!s.isDelete()||!i.isDelete())&&n+i.chars===r)}},{key:"transform",value:function(e){return t.transform(this,e)}}],[{key:"fromJSON",value:function(e){for(var r=new t,n=0,s=e.length;n<s;n++){var o=e[n],a={};"object"===u(o)&&(a=o,o=e[++n]),"number"==typeof o?o>0?r.retain(o,a):r.delete(-o):(i("string"==typeof o),r.insert(o,a))}return r}},{key:"getSimpleOp",value:function(t){var e=t.ops;switch(e.length){case 1:return e[0];case 2:return e[0].isRetain()?e[1]:e[1].isRetain()?e[0]:null;case 3:if(e[0].isRetain()&&e[2].isRetain())return e[1]}return null}},{key:"getStartIndex",value:function(t){return t.ops[0].isRetain()?t.ops[0].chars:0}},{key:"transformAttributes",value:function(t,e){var r,n={},s={},o={};for(r in t)o[r]=!0;for(r in e)o[r]=!0;for(r in o){var a=t[r],h=e[r];i(null!=a||null!=h),null==a?s[r]=h:null==h?n[r]=a:a===h||(n[r]=a)}return[n,s]}},{key:"transform",value:function(e,r){if(e.baseLength!==r.baseLength)throw new Error("Both operations have to have the same base length");for(var n=new t,s=new t,i=e.clone().ops,o=r.clone().ops,a=0,h=0,u=i[a++],c=o[h++];void 0!==u||void 0!==c;)if(u&&u.isInsert())n.insert(u.text,u.attributes),s.retain(u.text.length),u=i[a++];else if(c&&c.isInsert())n.retain(c.text.length),s.insert(c.text,c.attributes),c=o[h++];else{if(void 0===u)throw new Error("Cannot transform operations: first operation is too short.");if(void 0===c)throw new Error("Cannot transform operations: first operation is too long.");var l=void 0;if(u.isRetain()&&c.isRetain()){var f=t.transformAttributes(u.attributes,c.attributes);u.chars>c.chars?(l=c.chars,u.chars-=c.chars,c=o[h++]):u.chars===c.chars?(l=c.chars,u=i[a++],c=o[h++]):(l=u.chars,c.chars-=u.chars,u=i[a++]),n.retain(l,f[0]),s.retain(l,f[1])}else if(u.isDelete()&&c.isDelete())u.chars>c.chars?(u.chars-=c.chars,c=o[h++]):u.chars===c.chars?(u=i[a++],c=o[h++]):(c.chars-=u.chars,u=i[a++]);else if(u.isDelete()&&c.isRetain())u.chars>c.chars?(l=c.chars,u.chars-=c.chars,c=o[h++]):u.chars===c.chars?(l=c.chars,u=i[a++],c=o[h++]):(l=u.chars,c.chars-=u.chars,u=i[a++]),n.delete(l);else{if(!u.isRetain()||!c.isDelete())throw new Error("The two operations aren't compatible");u.chars>c.chars?(l=c.chars,u.chars-=c.chars,c=o[h++]):u.chars===c.chars?(l=u.chars,u=i[a++],c=o[h++]):(l=u.chars,c.chars-=u.chars,u=i[a++]),s.delete(l)}}return[n,s]}}]),t}();r.d(e,"Cursor",function(){return s}),r.d(e,"TextOperation",function(){return l})}])});