!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var s in r)("object"==typeof exports?exports:t)[s]=r[s]}}(this,function(){return function(t){function e(s){if(r[s])return r[s].exports;var n=r[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,s){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=e.assert=function(t,e){if(!t)throw new Error(e||"assertion error")};e.default=s},function(t,e,r){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=r(2);Object.defineProperty(e,"Cursor",{enumerable:!0,get:function(){return s(n).default}});var i=r(3);Object.defineProperty(e,"TextOperation",{enumerable:!0,get:function(){return s(i).default}})},function(t,e,r){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),i=function(){function t(e,r){s(this,t),this.position=e,this.selectionEnd=r}return n(t,[{key:"equals",value:function(t){return this.position===t.position&&this.selectionEnd===t.selectionEnd}},{key:"compose",value:function(t){return t}},{key:"transform",value:function(e){function r(t){for(var r=t,s=e.ops,n=0,i=e.ops.length;n<i&&(s[n].isRetain()?t-=s[n].chars:s[n].isInsert()?r+=s[n].text.length:(r-=Math.min(t,s[n].chars),t-=s[n].chars),!(t<0));n++);return r}var s=r(this.position);return this.position===this.selectionEnd?new t(s,s):new t(s,r(this.selectionEnd))}}],[{key:"fromJSON",value:function(e){return new t(e.position,e.selectionEnd)}}]),t}();e.default=i},function(t,e,r){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),o=r(4),a=function(t){return t&&t.__esModule?t:{default:t}}(o),h=r(0),u=function(){function t(){s(this,t),this.ops=[],this.baseLength=0,this.targetLength=0}return i(t,[{key:"equals",value:function(t){if(this.baseLength!==t.baseLength)return!1;if(this.targetLength!==t.targetLength)return!1;if(this.ops.length!==t.ops.length)return!1;for(var e=0;e<this.ops.length;e++)if(!this.ops[e].equals(t.ops[e]))return!1;return!0}},{key:"retain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("number"!=typeof t||t<0)throw new Error("retain expects a positive integer.");if(0===t)return this;this.baseLength+=t,this.targetLength+=t;var r=this.ops.length>0?this.ops[this.ops.length-1]:null;return r&&r.isRetain()&&r.attributesEqual(e)?r.chars+=t:this.ops.push(new a.default("retain",t,e)),this}},{key:"insert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof t)throw new Error("insert expects a string");if(""===t)return this;this.targetLength+=t.length;var r=this.ops.length>0?this.ops[this.ops.length-1]:null,s=this.ops.length>1?this.ops[this.ops.length-2]:null;return r&&r.isInsert()&&r.attributesEqual(e)?r.text+=t:r&&r.isDelete()?s&&s.isInsert()&&s.attributesEqual(e)?s.text+=t:(this.ops[this.ops.length-1]=new a.default("insert",t,e),this.ops.push(r)):this.ops.push(new a.default("insert",t,e)),this}},{key:"delete",value:function(t){if("string"==typeof t&&(t=t.length),"number"!=typeof t||t<0)throw new Error("delete expects a positive integer or a string");if(0===t)return this;this.baseLength+=t;var e=this.ops.length>0?this.ops[this.ops.length-1]:null;return e&&e.isDelete()?e.chars+=t:this.ops.push(new a.default("delete",t)),this}},{key:"isNoop",value:function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()}},{key:"clone",value:function(){for(var e=new t,r=0;r<this.ops.length;r++)this.ops[r].isRetain()?e.retain(this.ops[r].chars,this.ops[r].attributes):this.ops[r].isInsert()?e.insert(this.ops[r].text,this.ops[r].attributes):e.delete(this.ops[r].chars);return e}},{key:"toString",value:function(){return this.ops.map(function(t){return t.isRetain()?"retain "+t.chars:t.isInsert()?"insert '"+t.text+"'":"delete "+t.chars}).join(", ")}},{key:"toJSON",value:function(){for(var t=[],e=0;e<this.ops.length;e++)this.ops[e].hasEmptyAttributes()||t.push(this.ops[e].attributes),"retain"===this.ops[e].type?t.push(this.ops[e].chars):"insert"===this.ops[e].type?t.push(this.ops[e].text):"delete"===this.ops[e].type&&t.push(-this.ops[e].chars);return t}},{key:"apply",value:function(t,e,r){var s=this;if(e=e||[],r=r||[],t.length!==s.baseLength)throw new Error("The operation's base length must be equal to the string's length.");for(var n=[],i=0,o=void 0,a=void 0,u=0,l=this.ops,c=0,f=l.length;c<f;c++){var p=l[c];if(p.isRetain()){if(u+p.chars>t.length)throw new Error("Operation can't retain more characters than are left in the string.");for(n[i++]=t.slice(u,u+p.chars),o=0;o<p.chars;o++){var v=e[u+o]||{},b={};for(a in v)b[a]=v[a],(0,h.assert)(!1!==b[a]);for(a in p.attributes)!1===p.attributes[a]?delete b[a]:b[a]=p.attributes[a],(0,h.assert)(!1!==b[a]);r.push(b)}u+=p.chars}else if(p.isInsert())for(n[i++]=p.text,o=0;o<p.text.length;o++){var g={};for(a in p.attributes)g[a]=p.attributes[a],(0,h.assert)(!1!==g[a]);r.push(g)}else u+=p.chars}if(u!==t.length)throw new Error("The operation didn't operate on the whole string.");var y=n.join("");return(0,h.assert)(y.length===r.length),y}},{key:"invert",value:function(e){for(var r=0,s=new t,n=this.ops,i=0,o=n.length;i<o;i++){var a=n[i];a.isRetain()?(s.retain(a.chars),r+=a.chars):a.isInsert()?s.delete(a.text.length):(s.insert(e.slice(r,r+a.chars)),r+=a.chars)}return s}},{key:"compose",value:function(e){function r(t,e,r){var s={},n=void 0;for(n in t)s[n]=t[n];for(n in e)r&&!1===e[n]?delete s[n]:s[n]=e[n];return s}var s=this;if(s.targetLength!==e.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");for(var n=new t,i=s.clone().ops,o=e.clone().ops,a=0,h=0,u=i[a++],l=o[h++],c=void 0;;){if(void 0===u&&void 0===l)break;if(u&&u.isDelete())n.delete(u.chars),u=i[a++];else if(l&&l.isInsert())n.insert(l.text,l.attributes),l=o[h++];else{if(void 0===u)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===l)throw new Error("Cannot compose operations: first operation is too long.");if(u.isRetain()&&l.isRetain())c=r(u.attributes,l.attributes),u.chars>l.chars?(n.retain(l.chars,c),u.chars-=l.chars,l=o[h++]):u.chars===l.chars?(n.retain(u.chars,c),u=i[a++],l=o[h++]):(n.retain(u.chars,c),l.chars-=u.chars,u=i[a++]);else if(u.isInsert()&&l.isDelete())u.text.length>l.chars?(u.text=u.text.slice(l.chars),l=o[h++]):u.text.length===l.chars?(u=i[a++],l=o[h++]):(l.chars-=u.text.length,u=i[a++]);else if(u.isInsert()&&l.isRetain())c=r(u.attributes,l.attributes,!0),u.text.length>l.chars?(n.insert(u.text.slice(0,l.chars),c),u.text=u.text.slice(l.chars),l=o[h++]):u.text.length===l.chars?(n.insert(u.text,c),u=i[a++],l=o[h++]):(n.insert(u.text,c),l.chars-=u.text.length,u=i[a++]);else{if(!u.isRetain()||!l.isDelete())throw new Error("This shouldn't happen: op1: "+JSON.stringify(u)+", op2: "+JSON.stringify(l));u.chars>l.chars?(n.delete(l.chars),u.chars-=l.chars,l=o[h++]):u.chars===l.chars?(n.delete(l.chars),u=i[a++],l=o[h++]):(n.delete(u.chars),l.chars-=u.chars,u=i[a++])}}}return n}},{key:"shouldBeComposedWith",value:function(e){if(this.isNoop()||e.isNoop())return!0;var r=t.getStartIndex(this),s=t.getStartIndex(e),n=t.getSimpleOp(this),i=t.getSimpleOp(e);return!(!n||!i)&&(n.isInsert()&&i.isInsert()?r+n.text.length===s:!(!n.isDelete()||!i.isDelete())&&(s+i.chars===r||r===s))}},{key:"shouldBeComposedWithInverted",value:function(e){if(this.isNoop()||e.isNoop())return!0;var r=t.getStartIndex(this),s=t.getStartIndex(e),n=t.getSimpleOp(this),i=t.getSimpleOp(e);return!(!n||!i)&&(n.isInsert()&&i.isInsert()?r+n.text.length===s||r===s:!(!n.isDelete()||!i.isDelete())&&s+i.chars===r)}},{key:"transform",value:function(e){return t.transform(this,e)}}],[{key:"fromJSON",value:function(e){for(var r=new t,s=0,i=e.length;s<i;s++){var o=e[s],a={};"object"===(void 0===o?"undefined":n(o))&&(a=o,s++,o=e[s]),"number"==typeof o?o>0?r.retain(o,a):r.delete(-o):((0,h.assert)("string"==typeof o),r.insert(o,a))}return r}},{key:"getSimpleOp",value:function(t){var e=t.ops;switch(e.length){case 1:return e[0];case 2:return e[0].isRetain()?e[1]:e[1].isRetain()?e[0]:null;case 3:if(e[0].isRetain()&&e[2].isRetain())return e[1]}return null}},{key:"getStartIndex",value:function(t){return t.ops[0].isRetain()?t.ops[0].chars:0}},{key:"transformAttributes",value:function(t,e){var r={},s={},n=void 0,i={};for(n in t)i[n]=!0;for(n in e)i[n]=!0;for(n in i){var o=t[n],a=e[n];(0,h.assert)(null!=o||null!=a),null==o?s[n]=a:null==a?r[n]=o:o===a||(r[n]=o)}return[r,s]}},{key:"transform",value:function(e,r){if(e.baseLength!==r.baseLength)throw new Error("Both operations have to have the same base length");for(var s=new t,n=new t,i=e.clone().ops,o=r.clone().ops,a=0,h=0,u=i[a++],l=o[h++];;){if(void 0===u&&void 0===l)break;if(u&&u.isInsert())s.insert(u.text,u.attributes),n.retain(u.text.length),u=i[a++];else if(l&&l.isInsert())s.retain(l.text.length),n.insert(l.text,l.attributes),l=o[h++];else{if(void 0===u)throw new Error("Cannot transform operations: first operation is too short.");if(void 0===l)throw new Error("Cannot transform operations: first operation is too long.");var c=void 0;if(u.isRetain()&&l.isRetain()){var f=t.transformAttributes(u.attributes,l.attributes);u.chars>l.chars?(c=l.chars,u.chars-=l.chars,l=o[h++]):u.chars===l.chars?(c=l.chars,u=i[a++],l=o[h++]):(c=u.chars,l.chars-=u.chars,u=i[a++]),s.retain(c,f[0]),n.retain(c,f[1])}else if(u.isDelete()&&l.isDelete())u.chars>l.chars?(u.chars-=l.chars,l=o[h++]):u.chars===l.chars?(u=i[a++],l=o[h++]):(l.chars-=u.chars,u=i[a++]);else if(u.isDelete()&&l.isRetain())u.chars>l.chars?(c=l.chars,u.chars-=l.chars,l=o[h++]):u.chars===l.chars?(c=l.chars,u=i[a++],l=o[h++]):(c=u.chars,l.chars-=u.chars,u=i[a++]),s.delete(c);else{if(!u.isRetain()||!l.isDelete())throw new Error("The two operations aren't compatible");u.chars>l.chars?(c=l.chars,u.chars-=l.chars,l=o[h++]):u.chars===l.chars?(c=u.chars,u=i[a++],l=o[h++]):(c=u.chars,l.chars-=u.chars,u=i[a++]),n.delete(c)}}}return[s,n]}}]),t}();e.default=u},function(t,e,r){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),o=r(0),a=function(){function t(e){s(this,t),this.type=e,this.chars=null,this.text=null,this.attributes=null,"insert"===e?(this.text=arguments.length<=1?void 0:arguments[1],(0,o.assert)("string"==typeof this.text),this.attributes=(arguments.length<=2?void 0:arguments[2])||{},(0,o.assert)("object"===n(this.attributes))):"delete"===e?(this.chars=arguments.length<=1?void 0:arguments[1],(0,o.assert)("number"==typeof this.chars)):"retain"===e&&(this.chars=arguments.length<=1?void 0:arguments[1],(0,o.assert)("number"==typeof this.chars),this.attributes=(arguments.length<=2?void 0:arguments[2])||{},(0,o.assert)("object"===n(this.attributes)))}return i(t,[{key:"isInsert",value:function(){return"insert"===this.type}},{key:"isDelete",value:function(){return"delete"===this.type}},{key:"isRetain",value:function(){return"retain"===this.type}},{key:"equals",value:function(t){return this.type===t.type&&this.text===t.text&&this.chars===t.chars&&this.attributesEqual(t.attributes)}},{key:"attributesEqual",value:function(t){var e=this;return t&&this.attributes?Object.keys(this.attributes).every(function(r){return e.attributes[r]===t[r]})&&Object.keys(t).every(function(r){return e.attributes[r]===t[r]}):t===this.attributes}},{key:"hasEmptyAttributes",value:function(){var t=!0;for(var e in this.attributes){t=!1;break}return t}}]),t}();e.default=a}])});